<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬è–èª•ä¹‹æ—…</title>
    <link rel="manifest" href="/manifest.json">
    
    <style>
        /* 1. Vibe Coding: åŸºç¤è¨­ç½®èˆ‡é…è‰² */
        body {
            font-family: 'Hiragino Sans', 'Noto Sans TC', sans-serif;
            background-color: #FAFAFA; /* æš–ç™½èƒŒæ™¯ */
            margin: 0;
            padding: 0;
            color: #333333; /* æ·±ç°æ–‡å­— */
        }
        /* é ‚éƒ¨å°èˆªæ¬„ (åˆ†é åˆ‡æ›) */
        .tab-nav {
            display: flex;
            justify-content: space-around;
            background-color: #FFFFFF;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        .tab-button {
            border: none;
            background: none;
            padding: 10px 15px;
            font-size: 1em;
            cursor: pointer;
            font-weight: 600;
            color: #AAAAAA;
            transition: color 0.3s;
        }
        .tab-button.active {
            color: #008CBA; /* ä¸»é¡Œè— */
            border-bottom: 3px solid #008CBA;
        }

        /* 2. Vibe Coding: ä½ˆå±€èˆ‡ç•™ç™½ */
        .content {
            padding: 20px;
        }
        .day-header {
            margin-bottom: 25px;
            padding-left: 5px;
        }
        .day-header h2 {
            font-size: 1.5em;
            color: #333;
            margin: 0;
        }

        /* 3. Vibe Coding: å¡ç‰‡è¨­è¨ˆ */
        .card {
            background-color: #FFFFFF;
            border-radius: 12px;
            padding: 20px 24px; /* å……è¶³çš„ç•™ç™½ */
            margin-bottom: 32px; /* æ‹‰é–‹å¡ç‰‡é–“è· */
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05); /* æŸ”å’Œé™°å½± */
            line-height: 1.6;
        }
        
        /* 4. å¤©æ°£ Placeholder */
        .weather-info {
            background-color: #E6F7FF; /* æ·ºè—è‰² */
            color: #007bb5;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: bold;
            margin-bottom: 15px;
            font-size: 0.9em;
            /* éƒ¨ç½²å¾Œéœ€é€é JS é¡¯ç¤º */
        }
        
        /* è¡Œç¨‹åˆ—è¡¨ */
        .item-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        .item-list li {
            padding: 10px 0;
            border-bottom: 1px dashed #F0F0F0; /* æŸ”å’Œè™›ç·š */
            font-size: 0.95em;
        }
        .item-list li:last-child {
            border-bottom: none;
        }
        .item-list .time {
            font-weight: bold;
            color: #555;
            margin-right: 8px;
            display: inline-block;
            min-width: 60px; /* ç¢ºä¿æ™‚é–“å°é½Š */
        }
        .item-list ul {
            padding-left: 15px;
        }

        /* 5. Vibe Coding: æ¨™ç±¤è¨­è¨ˆ */
        .tag {
            display: inline-block;
            padding: 4px 8px;
            margin: 3px 5px 3px 0;
            border-radius: 5px;
            font-size: 0.75em;
            font-weight: bold;
        }
        .tag-pass { background-color: #FFE0E6; color: #D83A56; } 
        .tag-must-do { background-color: #E0F7E6; color: #4CAF50; } 
        .tag-food { background-color: #FFF8E1; color: #FF9800; } 
        .tag-reservation { background-color: #EDE7F6; color: #673AB7; } 
        .tag-buy { background-color: #E0F7FA; color: #00BCD4; } 
        .tag-story { background-color: #F3E5F5; color: #9C27B0; } 

        /* 6. å°èˆªæŒ‰éˆ• */
        .nav-button {
            display: block;
            text-align: center;
            background-color: #008CBA;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            text-decoration: none;
            font-size: 0.95em;
            margin-top: 15px;
            transition: background-color 0.3s;
        }
        
        /* è¨˜å¸³é é¢æ¨£å¼ */
        .budget-input-group {
            margin-bottom: 15px;
        }
        .budget-input-group input, .budget-input-group select {
            padding: 8px;
            width: 100%;
            box-sizing: border-box;
            margin-top: 5px;
        }
        .delete-btn {
            color: red; 
            cursor: pointer; 
            float: right;
            font-weight: bold;
            margin-left: 10px;
        }
    </style>
</head>
<body>

    <div class="tab-nav">
        <button id="tab-schedule-btn" class="tab-button active" onclick="showTab('schedule', this)">æ—¥ç¨‹æ¦‚è¦½</button>
        <button id="tab-info-btn" class="tab-button" onclick="showTab('info', this)">æ—…ç¨‹è³‡è¨Š</button>
        <button id="tab-budget-btn" class="tab-button" onclick="showTab('budget', this)">è¨˜å¸³/é ç®—</button>
    </div>

    <div id="schedule" class="content">

        <header class="day-header">
            <h2>ğŸ—“ï¸ 12 æœˆ 8 æ—¥ï¼ˆé€±ä¸€ï¼‰</h2>
            <p>é«˜é›„å‡ºç™¼ï¼ŒæŠµé”è¿ªå£«å°¼æ¨‚åœ’</p>
        </header>
        
        <div class="card weather-info">
            â˜€ï¸ æ°£æº«: [API] | å¤©æ°£: [API] (å³æ™‚è³‡è¨Š Placeholder)
        </div>

        <div class="card">
            <h3>âœˆï¸ èˆªç­èˆ‡äº¤é€š</h3>
            <ul class="item-list">
                <li><span class="time">08:00</span> âœˆï¸ é«˜é›„ (KHH) èµ·é£› â¡ï¸ æ±äº¬ (NRT) <span class="tag tag-reservation">KLOOKå…ˆå®šåˆ©æœ¨æ´¥</span></li>
                <li><span class="time">12:20</span> æŠµé”æˆç”°æ©Ÿå ´ï¼ˆèˆªå»ˆ 2ï¼‰</li>
                <li>
                    <span class="time">åˆ©æœ¨æ´¥å·´å£«</span> (NRT T2 â¡ï¸ Fantasy Springs Hotel)
                    <br>
                    å»ºè­°ç­æ¬¡ï¼š<span class="tag tag-reservation">13:35 å‡ºç™¼</span> â¡ï¸ <span class="tag tag-reservation">14:58 æŠµé”</span>
                    <a href="http://googleusercontent.com/maps.google.com/search?q=Tokyo+DisneySea+Fantasy+Springs+Hotel" class="nav-button">
                        ğŸ—ºï¸ å°èˆªè‡³è¿ªå£«å°¼é£¯åº—
                    </a>
                </li>
            </ul>
        </div>

        <div class="card">
            <h3>ğŸ° æ±äº¬è¿ªå£«å°¼æ¨‚åœ’</h3>
            <ul class="item-list">
                <li><span class="time">17:00</span> **ç¾å¥³èˆ‡é‡ç¸** (é ç´„é …ç›®) <span class="tag tag-reservation">éœ€é ç´„</span></li>
                <li>
                    **å¿…ç©/å¿«é€Ÿé€šé—œ**
                    <br>
                    <span class="tag tag-pass">å·¨é›·å±±</span>
                    <span class="tag tag-pass">å¹½éˆå…¬é¤¨</span>
                    <span class="tag tag-must-do">å°å°ä¸–ç•Œ</span> <span class="tag tag-must-do">æ¯éºµ</span>
                </li>
                <li>
                    **å¿…åƒç¾é£Ÿ**
                    <br>
                    <span class="tag tag-food">æ°´æ™¶å®® (åƒåˆ°é£½)</span>
                    <span class="tag tag-food">ä¸­å¤®å¤§é“å’–å•¡é¤é¤¨ (æ¯éºµå’–å“©é£¯)</span>
                    <a href="http://googleusercontent.com/maps.google.com/search?q=Tokyo+Disneyland" class="nav-button">
                        ğŸ—ºï¸ å°èˆªè‡³è¿ªå£«å°¼æ¨‚åœ’
                    </a>
                </li>
            </ul>
        </div>
        
        <header class="day-header">
            <h2>ğŸ—“ï¸ 12 æœˆ 9 æ—¥ï¼ˆé€±äºŒï¼‰</h2>
            <p>è¿ªå£«å°¼æµ·æ´‹èˆ‡æ±äº¬å¸‚å€</p>
        </header>
        <div class="card">
            <h3>ğŸ”± æ±äº¬è¿ªå£«å°¼æµ·æ´‹ - å¤¢å¹»æ³‰é„‰</h3>
            <span class="tag tag-story">æ”»ç•¥: å¤¢å¹»æ³‰é„‰ç‚ºæœ€æ–°åœ’å€ï¼Œå¿…ç© Peter Pan, Elsa, Rapunzel è¨­æ–½ï¼</span>
            <ul class="item-list">
                <li><span class="time">08:20</span> æ—©é¤é ç´„</li>
                <li><span class="time">12:00</span> é£¯åº—é€€æˆ¿</li>
                <li><span class="time">å¿…ç©</span> <span class="tag tag-must-do">ç©å…·ç¸½å‹•å“¡</span> <span class="tag tag-must-do">é©šé­‚å¤å¡”</span> <span class="tag tag-must-do">åœ°å¿ƒæ¢éšª</span></li>
            </ul>
            <a href="http://googleusercontent.com/maps.google.com/search?q=Tokyo+DisneySea" class="nav-button">
                ğŸ—ºï¸ å°èˆªè‡³è¿ªå£«å°¼æµ·æ´‹
            </a>
        </div>
        
        <header class="day-header">
            <h2>ğŸ—“ï¸ 12 æœˆ 10 æ—¥ï¼ˆé€±ä¸‰ï¼‰</h2>
            <p>å‰ä¼Šå¡å“‡èˆ‡è–èª•å¸‚é›†</p>
        </header>
        <div class="card">
            <h3>ğŸ›ï¸ å‰ä¼Šå¡å“‡/å·è¶Šèˆ‡è³¼ç‰©</h3>
            <ul class="item-list">
                <li><span class="time">äº¤é€š</span> å±±æ‰‹ç·šè‡³æ± è¢‹ â¡ï¸ æ±æ­¦æ±ä¸Šç·š</li>
                <li><span class="time">æ—©åˆé¤</span> <span class="tag tag-food">bills è¡¨åƒé“</span> æˆ– <span class="tag tag-food">Negishi (ç‰›èˆŒ)</span></li>
                <li><span class="time">ä¸‹åˆ</span> æ­¥è¡Œ <span class="tag tag-buy">å‰ä¼Šå¡å“‡ MOGUMOGU æœ¬èˆ–</span></li>
                <li><span class="time">18:30</span> Christmas Market Tokyo 2025 (ç¥å®®å¤–è‹‘)</li>
            </ul>
            <a href="http://googleusercontent.com/maps.google.com/search?q=Chiikawa+park" class="nav-button">
                ğŸ—ºï¸ å°èˆªè‡³å‰ä¼Šå¡å“‡MOGUMOGUæœ¬èˆ–
            </a>
        </div>
        
        <header class="day-header">
            <h2>ğŸ—“ï¸ 12 æœˆ 11 æ—¥ï¼ˆé€±å››ï¼‰</h2>
            <p>æ™´ç©ºå¡”èˆ‡éŠ€åº§</p>
        </header>
        <div class="card">
            <h3>ğŸ—¼ æ™´ç©ºå¡”/éŠ€åº§</h3>
            <ul class="item-list">
                <li><span class="time">08:00</span> Brunch: <span class="tag tag-food">Tricolore coffee</span></li>
                <li><span class="time">11:00</span> æ™´ç©ºå¡” (é è¨ˆå¾… 3-4 å°æ™‚)</li>
                <li><span class="time">å‚æ™š</span> ä¸¸ä¹‹å…§ä»²é€š / éŠ€åº§æ­¥è¡Œé€›è¡—</li>
            </ul>
            <a href="http://googleusercontent.com/maps.google.com/search?q=Tokyo+Skytree" class="nav-button">
                ğŸ—ºï¸ å°èˆªè‡³æ™´ç©ºå¡”
            </a>
        </div>

        <header class="day-header">
            <h2>ğŸ—“ï¸ 12 æœˆ 12 æ—¥ï¼ˆé€±äº”ï¼‰</h2>
            <p>è¿”ç¨‹</p>
        </header>
        <div class="card">
            <h3>âœˆï¸ è¿”ç¨‹èˆ‡è³¼ç‰©</h3>
            <ul class="item-list">
                <li><span class="time">08:00</span> Check out / æœ‰æ¨‚ç”ºå¯„è¡Œæ</li>
                <li><span class="time">ä¸Šåˆ</span> TSUTAYA BOOKSTORE APIT æ±é›²åº—</li>
                <li><span class="time">18:25</span> æ±äº¬ (NRT) â¡ï¸ é«˜é›„ (KHH)</li>
            </ul>
        </div>
    </div>


    <div id="info" class="content" style="display:none;">
        <h2>ğŸ“ æ—…ç¨‹è³‡è¨Š</h2>
            
        <div class="card">
            <h3>âœˆï¸ èˆªç­è³‡è¨Š</h3>
            <ul class="item-list">
                <li><span class="time">å»ç¨‹</span> 12/8 (é€±ä¸€) 08:00 é«˜é›„ (KHH) â¡ï¸ æ±äº¬ (NRT) 12:20</li>
                <li><span class="time">å›ç¨‹</span> 12/12 (é€±äº”) 18:25 æ±äº¬ (NRT) â¡ï¸ é«˜é›„ (KHH) 22:05</li>
            </ul>
        </div>
            
        <div class="card">
            <h3>ğŸ¨ ä½å®¿è³‡è¨Š</h3>
            <ul class="item-list">
                <li><span class="time">12/8 - 12/9</span> æ±äº¬è¿ªå£«å°¼æµ·æ´‹å¤¢å¹»æ³‰é„‰é£¯åº—</li>
                <li><span class="time">12/9 - 12/XX</span> Agoda é è¨‚é£¯åº— (è«‹è‡ªè¡Œå¡«å¯«)</li>
            </ul>
        </div>
            
        <div class="card">
            <h3>ğŸ“ ç·Šæ€¥è¯çµ¡é›»è©±èˆ‡å¿…å‚™å“</h3>
            <ul class="item-list">
                <li>**å¿…éœ€å“**ï¼šè­·ç…§ã€SIMå¡ (Klook eSIM)ã€æ‰‹æ©Ÿ+ç›¸æ©Ÿå……é›»å™¨ã€èƒƒè—¥</li>
                <li>**æ—¥æœ¬è­¦å¯Ÿ**ï¼š110</li>
                <li>**æ•‘è­·/æ¶ˆé˜²**ï¼š119</li>
                <li>**é‡è¦é ç´„**ï¼šåˆ©æœ¨æ´¥å·´å£«ç¥¨ã€é›™æ—¥è­·ç…§</li>
            </ul>
        </div>
    </div>

    <div id="budget" class="content" style="display:none;">
        <h2>ğŸ’° è¨˜å¸³/é ç®—ä¸­å¿ƒ</h2>
        
        <div class="card" style="background-color: #f0fff0;">
            <h3>ğŸ’¸ ç¸½é ç®—èˆ‡åŒ¯ç‡è¨­å®š</h3>
            <p>ä»Šæ—¥å‰©é¤˜ï¼š<strong id="daily-remaining">Â¥0</strong> / ç¸½å‰©é¤˜ï¼š<strong id="total-remaining">Â¥0</strong></p>
            <div class="budget-input-group">
                <label for="totalBudget">ç¸½é ç®— (JPY):</label>
                <input type="number" id="totalBudget" value="100000" min="0">
            </div>
            <div class="budget-input-group">
                <label for="exchangeRate">JPY å°å°å¹£åŒ¯ç‡ (ä¾‹ï¼š0.215):</label>
                <input type="number" id="exchangeRate" value="0.215" step="0.001">
                <button onclick="saveSettings()" style="background-color:#008CBA; color:white; border:none; padding: 6px 12px; border-radius: 5px; margin-top: 10px;">å„²å­˜è¨­å®š</button>
            </div>
        </div>
        
        <div class="card">
            <h3>â• æ–°å¢æ”¯å‡º</h3>
            <div class="budget-input-group">
                <input type="text" id="expenseDesc" placeholder="é …ç›® (ä¾‹å¦‚ï¼šåˆé¤)">
            </div>
            <div class="budget-input-group">
                <input type="number" id="expenseAmount" placeholder="é‡‘é¡ (JPY)">
            </div>
            <button onclick="addExpense()" class="nav-button" style="background-color:#4CAF50; margin-top: 5px;">è¨˜éŒ„æ”¯å‡º</button>
        </div>

        <div class="card">
            <h3>ğŸ§¾ æ”¯å‡ºæ˜ç´°</h3>
            <ul id="expenseList" class="item-list">
                </ul>
            <p style="text-align: right; margin-top: 15px;">ç¸½æ”¯å‡º (TWD)ï¼š<strong id="total-twd">NT$ 0</strong></p>
        </div>
    </div>


    <script>
        // === PWA æœå‹™å·¥ä½œç·šç¨‹è¨»å†Š ===
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js').then(registration => {
                    console.log('SW registered: ', registration);
                }).catch(registrationError => {
                    console.log('SW registration failed: ', registrationError);
                });
            });
        }
        
        // === é ‚éƒ¨ Tab åˆ†é åˆ‡æ›åŠŸèƒ½ ===
        function showTab(tabId, clickedButton) {
            // éš±è—æ‰€æœ‰å…§å®¹å€å¡Š
            document.getElementById('schedule').style.display = 'none';
            document.getElementById('info').style.display = 'none';
            document.getElementById('budget').style.display = 'none';

            // é¡¯ç¤ºé¸æ“‡çš„å€å¡Š
            document.getElementById(tabId).style.display = 'block';

            // æ›´æ–°æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            clickedButton.classList.add('active');
        }

        // === é›¢ç·šè¨˜å¸³åŠŸèƒ½ JavaScript ===
        let expenses = [];
        const today = new Date().toISOString().slice(0, 10);

        // å‡½æ•¸ï¼šè¼‰å…¥è¨­å®šå’Œæ”¯å‡ºæ•¸æ“š
        function loadData() {
            // è¼‰å…¥è¨­å®š
            const savedBudget = localStorage.getItem('totalBudget') || 100000;
            const savedRate = localStorage.getItem('exchangeRate') || 0.215;
            document.getElementById('totalBudget').value = savedBudget;
            document.getElementById('exchangeRate').value = savedRate;

            // è¼‰å…¥æ”¯å‡º
            const savedExpenses = localStorage.getItem('expenses');
            if (savedExpenses) {
                expenses = JSON.parse(savedExpenses);
            }
            renderExpenses();
            updateSummary();
        }

        // å‡½æ•¸ï¼šå„²å­˜è¨­å®š
        function saveSettings() {
            const budget = document.getElementById('totalBudget').value;
            const rate = document.getElementById('exchangeRate').value;
            localStorage.setItem('totalBudget', budget);
            localStorage.setItem('exchangeRate', rate);
            updateSummary();
            alert('è¨­å®šå·²å„²å­˜ï¼');
        }

        // å‡½æ•¸ï¼šæ–°å¢æ”¯å‡º
        function addExpense() {
            const desc = document.getElementById('expenseDesc').value.trim();
            const amount = parseFloat(document.getElementById('expenseAmount').value);

            if (!desc || isNaN(amount) || amount <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®å’Œé‡‘é¡ï¼');
                return;
            }

            const newExpense = {
                id: Date.now(),
                date: today,
                desc: desc,
                amount: amount,
            };

            expenses.push(newExpense);
            localStorage.setItem('expenses', JSON.stringify(expenses));

            // æ¸…ç©ºè¼¸å…¥æ¬„
            document.getElementById('expenseDesc').value = '';
            document.getElementById('expenseAmount').value = '';

            renderExpenses();
            updateSummary();
        }

        // å‡½æ•¸ï¼šåˆªé™¤æ”¯å‡º
        function deleteExpense(id) {
            if (!confirm('ç¢ºå®šåˆªé™¤æ­¤ç­†ç´€éŒ„å—ï¼Ÿ')) return;

            expenses = expenses.filter(exp => exp.id !== id);
            localStorage.setItem('expenses', JSON.stringify(expenses));
            renderExpenses();
            updateSummary();
        }

        // å‡½æ•¸ï¼šæ¸²æŸ“æ”¯å‡ºåˆ—è¡¨
        function renderExpenses() {
            const list = document.getElementById('expenseList');
            list.innerHTML = '';
            
            // æŒ‰æ—¥æœŸæœ€æ–°æ’åº
            expenses.sort((a, b) => b.id - a.id).forEach(exp => {
                const rate = parseFloat(localStorage.getItem('exchangeRate') || 0.215);
                const twdAmount = (exp.amount * rate).toFixed(0);
                
                const listItem = document.createElement('li');
                listItem.innerHTML = `
                    <span class="time">${exp.desc}</span> 
                    Â¥${exp.amount.toLocaleString()} 
                    (NT$ ${twdAmount.toLocaleString()})
                    <span class="delete-btn" onclick="deleteExpense(${exp.id})">[X]</span>
                `;
                list.appendChild(listItem);
            });
        }

        // å‡½æ•¸ï¼šæ›´æ–°ç¸½çµè³‡è¨Š
        function updateSummary() {
            const totalBudget = parseFloat(localStorage.getItem('totalBudget') || 100000);
            const exchangeRate = parseFloat(localStorage.getItem('exchangeRate') || 0.215);

            let totalSpentJPY = 0;
            let todaySpentJPY = 0;
            
            expenses.forEach(exp => {
                totalSpentJPY += exp.amount;
                if (exp.date === today) {
                    todaySpentJPY += exp.amount;
                }
            });

            const totalSpentTWD = (totalSpentJPY * exchangeRate).toFixed(0);
            const totalRemaining = totalBudget - totalSpentJPY;
            const dailyRemaining = totalBudget - todaySpentJPY;

            document.getElementById('total-remaining').textContent = `Â¥${totalRemaining.toLocaleString()}`;
            document.getElementById('daily-remaining').textContent = `Â¥${dailyRemaining.toLocaleString()}`;
            document.getElementById('total-twd').textContent = `NT$ ${totalSpentTWD.toLocaleString()}`;

            // æ ¹æ“šå‰©é¤˜é ç®—èª¿æ•´é¡è‰²
            if (totalRemaining < 0) {
                document.getElementById('total-remaining').style.color = 'red';
            } else {
                document.getElementById('total-remaining').style.color = '#4CAF50';
            }
        }

        // é é¢è¼‰å…¥å¾Œï¼Œå…ˆåŸ·è¡Œåˆå§‹åŒ–
        window.addEventListener('load', loadData); 
        
        // ç¢ºä¿åˆå§‹ç‹€æ…‹æ­£ç¢º
        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('info').style.display = 'none';
             document.getElementById('budget').style.display = 'none';
             document.getElementById('tab-schedule-btn').classList.add('active');
        });

    </script>
</body>
</html>
