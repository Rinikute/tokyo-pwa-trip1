<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ±äº¬è–èª•ä¹‹æ—… 2025</title>
    <link rel="manifest" href="/manifest.json">
    
    <script src="https://apis.google.com/js/api.js"></script>
    
    <style>
        /* 1. åŸºç¤è¨­ç½®èˆ‡å¥¶æ²¹æš–ç™½é…è‰² */
        body {
            font-family: 'Avenir Next', 'Hiragino Sans', 'Noto Sans TC', sans-serif;
            background-color: #FFFCF9; /* æœ€çµ‚æ±ºå®šï¼šå¥¶æ²¹æš–ç™½èƒŒæ™¯ */
            margin: 0;
            padding: 0;
            color: #333333; /* ä¸»è¦æ–‡å­—è‰² */
        }
        /* é ‚éƒ¨å°èˆªæ¬„ (å·¥å…·åˆ†é ) */
        .tab-nav {
            display: flex;
            overflow-x: auto; 
            white-space: nowrap; 
            background-color: #FFFFFF;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.03); 
            padding: 10px 0;
            position: sticky;
            top: 0;
            z-index: 200; /* ç½®é ‚ */
            justify-content: flex-end;
        }
        .tab-button {
            border: none;
            background: none;
            padding: 10px 15px;
            font-size: 0.95em;
            cursor: pointer;
            font-weight: 600;
            flex-shrink: 0;
            color: #AAAAAA;
            transition: color 0.3s;
        }
        .tab-button.active {
            color: #C48E44; /* ç±³é»ƒè‰²ç³»å¼·èª¿è‰² */
            border-bottom: 3px solid #C48E44;
        }

        /* 2. ä½ˆå±€èˆ‡å¡ç‰‡è¨­è¨ˆ */
        .content {
            padding: 10px 0;
        }
        /* *** æ²‰æµ¸å¼é ‚éƒ¨ Hero å€å¡Š *** */
        .hero-header {
            position: relative;
            width: 100%;
            overflow: hidden;
            margin-bottom: -40px; 
        }
        .hero-header img {
            width: 100%;
            height: auto;
            object-fit: contain; 
            filter: brightness(0.9); 
            display: block;
        }
        /* åº•éƒ¨æ¼¸å±¤ */
        .hero-header::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 35%; 
            background: linear-gradient(to top, rgba(0,0,0,0.65), rgba(0,0,0,0));
            z-index: 1;
        }
        /* åœ–ç‰‡ä¸Šçš„æ—¥æœŸæ¨™é¡Œå’Œè¨ˆæ™‚å™¨ */
        .hero-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            padding: 20px;
            box-sizing: border-box;
            z-index: 2;
        }
        .hero-time-display {
            font-size: 2.5em;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 5px;
            position: absolute;
            top: 15px;
            left: 20px;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        .hero-date-text {
            font-size: 0.9em;
            position: absolute;
            top: 60px;
            left: 20px;
            color: white;
            text-shadow: 0 1px 3px rgba(0,0,0,0.5);
        }
        /* æ–°å¢ï¼šå€’æ•¸è¨ˆæ™‚å™¨æ¨£å¼ */
        .countdown-display {
            position: absolute;
            top: 20px;
            right: 20px;
            color: white;
            font-size: 0.9em;
            font-weight: 600;
            background: rgba(0, 0, 0, 0.4);
            padding: 5px 10px;
            border-radius: 5px;
            letter-spacing: 1px;
            text-shadow: none;
        }
        
        /* *** æ—¥æœŸæ–¹å¡Šåˆ‡æ›å€ (Calendar Strip) *** */
        .calendar-strip {
            display: flex;
            overflow-x: auto;
            white-space: nowrap;
            margin: 0 20px;
            padding: 15px 0;
            background-color: transparent; 
            position: relative;
            z-index: 10;
        }
        .day-tab-box {
            background-color: white;
            color: #333;
            border: 1px solid #EAEAEA;
            border-radius: 8px;
            padding: 10px;
            margin-right: 12px;
            text-align: center;
            width: 60px; 
            min-width: 60px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.08);
            transition: all 0.2s;
        }
        .day-tab-box.active {
            background: #FFF8E0; 
            border-color: #C48E44; 
            color: #C48E44;
            transform: scale(1.02);
        }
        .day-tab-box .date-num {
            display: block;
            font-size: 1.5em;
            font-weight: 800;
            line-height: 1.2;
        }
        .day-tab-box .day-text {
            font-size: 0.8em;
            display: block;
        }
        /* *** æ ¸å¿ƒå…§å®¹å€å¡Š *** */
        .content {
            padding: 10px 0;
        }
        .day-title {
            margin: 0 20px 15px 20px;
            font-size: 1.8em;
            font-weight: bold;
            color: #444;
            letter-spacing: 2px;
        }
        .card {
            background-color: #FFFFFF; 
            border-radius: 12px; 
            padding: 20px 24px; 
            margin: 0 20px 25px 20px; 
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.03); 
            border: 1px solid #E8E8E8; 
            line-height: 1.6;
        }
        
        /* èˆªç­å¡ç‰‡ (æš–æ£•è‰²) */
        .flight-card {
            background-color: #7B6858; /* æ–°é¡è‰²: æš–æ£•è‰²/å¯å¯è‰² */
            color: white;
            border-radius: 12px;
            padding: 20px;
            margin: 0 20px 25px 20px;
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.2);
        }
        .flight-header { display: flex; justify-content: space-between; align-items: center; }
        .flight-time, .flight-airport { font-size: 2em; font-weight: 700; line-height: 1; margin-bottom: 5px; }
        .flight-details { text-align: center; margin-top: 10px; font-weight: 500; }
        .flight-number { font-size: 1.2em; font-weight: 600; color: #A3D2D9; }
        .flight-reminder { background: rgba(255, 255, 255, 0.2); color: white; padding: 5px 10px; border-radius: 6px; margin-top: 15px; display: inline-block; font-size: 0.9em; }

        /* åœ°åœ–/å°èˆªå€å¡Š */
        .map-container { 
            margin: 0 20px 20px 20px; 
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }
        .map-container iframe {
            width: 100%;
            height: 250px; 
            border: none;
            display: block;
        }
        /* æ–°å¢ï¼šå¯é»æ“Šåœ°é»åç¨±å–ä»£å°èˆªæŒ‰éˆ• */
        .location-link {
            display: block; 
            margin: 15px 0; 
            text-decoration: none;
            font-weight: bold;
            color: #C48E44; /* å¼·èª¿è‰² */
            font-size: 1.1em;
            padding: 10px 15px;
            background-color: #FFF8E0;
            border-radius: 8px;
            border: 1px solid #E8E8E8;
            text-align: center;
            transition: background-color 0.3s;
        }
        
        /* æ¨™ç±¤è¨­è¨ˆ (ä¿æŒä¸è®Š) */
        .tag { display: inline-block; padding: 4px 10px; margin: 3px 5px 3px 0; border-radius: 6px; font-size: 0.75em; font-weight: bold; }
        .tag-pass { background-color: #F4E8D4; color: #7B6858; } 
        .tag-food { background-color: #FFF0D6; color: #C48E44; } 
        .tag-reservation { background-color: #E0EBF7; color: #4C70A8; } 
        .action-button { background-color: #C48E44; color: #FFFFFF; padding: 10px 15px; border-radius: 6px; transition: background-color 0.3s; border: none; font-weight: bold; }
        .action-button.green { background-color: #79A37B; color: #FFFFFF; }
        .delete-btn { color: #D83A56; cursor: pointer; float: right; font-weight: bold; margin-left: 10px; }
        .weather-info { padding: 0; margin-bottom: 15px; border: none; box-shadow: none; background-color: transparent; }
        .weatherwidget-io { width: 100%; border-radius: 10px; overflow: hidden; border: 1px solid #E8E8E8; }

        /* Infoé é¢ - ä»»å‹™æ¸…å–®æ¨£å¼ (ä¿æŒä¸è®Š) */
        .task-list { list-style: none; padding: 0; margin: 0; }
        .task-list li {
            padding: 10px 0;
            border-bottom: 1px dashed #E5E5E5;
            display: flex;
            align-items: center;
        }
        .task-list li:last-child { border-bottom: none; }
        .task-list input[type="checkbox"] {
            margin-right: 15px;
            min-width: 20px;
            min-height: 20px;
            accent-color: #7B6858; /* ä½¿ç”¨æš–æ£•è‰²ä½œç‚ºå‹¾é¸è‰² */
            cursor: pointer;
        }
        /* è¨˜å¸³é é¢ç‰¹æ®Šæ¨£å¼ */
        .budget-input-group {
            margin-bottom: 15px;
        }
        .budget-input-group input {
            padding: 10px;
            border-radius: 6px; 
            border: 1px solid #E8E8E8;
            width: 100%;
            box-sizing: border-box;
            margin-top: 5px;
        }
        /* å°ˆé–€ç‚ºé ç®—å¡ç‰‡ä¸­çš„å°æŒ‰éˆ•èª¿æ•´ */
        .budget-input-group .action-button {
            width: auto; 
            display: inline-block; 
            padding: 5px 10px;
            margin-top: 5px;
        }
        .budget-input-group input[type="number"]#exchangeRate {
            width: 80px; 
            display: inline-block;
        }
    </style>
</head>
<body>

    <div class="tab-nav">
        <button id="tab-info-btn" class="tab-button" onclick="showTab('info', this)">è³‡è¨Š</button>
        <button id="tab-budget-btn" class="tab-button" onclick="showTab('budget', this)">è¨˜å¸³</button>
    </div>

    <div class="hero-header">
        <img src="/images/day01_arrival.jpg" alt="èƒŒæ™¯åœ–ç‰‡" class="hero-background" id="hero-img-bg"> 
        
        <div class="hero-content">
            <div class="hero-time-display" id="hero-time-display">08:00</div>
            <div class="hero-date-text" id="hero-date-text-display">2025.12.06 FRI</div>
            <div class="countdown-display" id="countdown-timer">è¨ˆç®—ä¸­...</div>
        </div>
    </div>
    
    <div class="calendar-strip">
        <div class="day-tab-box active" data-day-index="1" onclick="showDay('day-12-6', 1, this)"><span class="date-num">6</span><span class="day-text">FRI</span></div>
        <div class="day-tab-box" data-day-index="2" onclick="showDay('day-12-7', 2, this)"><span class="date-num">7</span><span class="day-text">SAT</span></div>
        <div class="day-tab-box" data-day-index="3" onclick="showDay('day-12-8', 3, this)"><span class="date-num">8</span><span class="day-text">SUN</span></div>
        <div class="day-tab-box" data-day-index="4" onclick="showDay('day-12-9', 4, this)"><span class="date-num">9</span><span class="day-text">MON</span></div>
        <div class="day-tab-box" data-day-index="5" onclick="showDay('day-12-10', 5, this)"><span class="date-num">10</span><span class="day-text">TUE</span></div>
        <div class="day-tab-box" data-day-index="6" onclick="showDay('day-12-11', 6, this)"><span class="date-num">11</span><span class="day-text">WED</span></div>
        <div class="day-tab-box" data-day-index="7" onclick="showDay('day-12-12', 7, this)"><span class="date-num">12</span><span class="day-text">THU</span></div>
    </div>
    
    <div class="content-wrapper">

        <div id="day-12-6" class="content">
            <div class="day-title">ç¬¬ä¸€å¤©ï¼šæŠµé”æ±äº¬</div>
            
            <div class="flight-card">
                <div class="flight-header">
                    <div><span class="flight-time">08:00</span><p class="flight-airport" style="font-size: 0.6em;">TPE å°åŒ— (å‡è¨­)</p></div>
                    <div><span class="flight-time">12:20</span><p class="flight-airport" style="font-size: 0.6em;">NRT æ±äº¬</p></div>
                </div>
                <div class="flight-details">
                    <span class="flight-number">CI 0102</span>
                    <div class="flight-line"></div>
                    <span class="flight-duration">4h 20m</span>
                </div>
                <div class="flight-reminder">
                    ğŸ’¼ è¨˜å¾—å¡«å¯« Visit Japan Web (å‡è¨­æé†’)
                </div>
            </div>

            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3242.418671064128!2d139.8010629752487!3d35.64205523212584!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x601889c619efffff%3A0xdd2da6a73aa930d2!2sA-PIT%20Super%20Autobacs!5e0!3m2!1szh-TW!2stw!4v1764142704837!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>
            
            <div class="card">
                <h3>âœˆï¸ äº¤é€šèˆ‡ä½å®¿</h3>
                <ul class="item-list">
                    <li><span class="time">äº¤é€š</span> æ­ä¹˜ SKYLINER ç­æ¬¡: <span class="tag tag-reservation">12:42</span> æˆ– <span class="tag tag-reservation">13:02</span> è‡³ä¸Šé‡</li>
                    <li><span class="time">ä½å®¿</span> Check-in Comfort Hotel Tokyo Kanda (12/6 - 12/8)</li>
                </ul>
            </div>
            <div class="card">
                <h3>ğŸš— ä¸‹åˆæ´»å‹•</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=æ±é›²A-PIT+Super+Autobacs" target="_blank" class="location-link">
                    ğŸ“ æ±é›² A-PIT Super Autobacs
                </a>
                <ul class="item-list">
                    <li><span class="time">ä¸‹åˆ</span> é€›è»Šç”¨å“</li>
                </ul>
            </div>
            <div class="card">
                <h3>ğŸ½ï¸ æ™šé¤é ç´„</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=è‚‰å±‹æ©«ä¸+ç§‹è‘‰åŸ" target="_blank" class="location-link">
                    ğŸ“ è‚‰å±‹æ©«ä¸ ç§‹è‘‰åŸ
                </a>
                <ul class="item-list">
                    <li><span class="time">20:00</span> é ç´„ <span class="tag tag-reservation">é‡è¦</span></li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>
        
        <div id="day-12-7" class="content" style="display:none;">
            <div class="day-title">ç¬¬äºŒå¤©ï¼šå·è¶Šèˆ‡åœ°ç“œå“‡</div>
            
            <img src="/images/day02_kawagoe.jpg" alt="å·è¶Šèˆ‡è–èª•å¸‚é›†" class="day-image">
            
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3230.9162671226336!2d139.47892697526183!3d35.92454951657047!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x6018db5ad3fee029%3A0x385f14ef6b654aee!2sChiikawa%20Mogumogu%20Hompo%20Kawagoe!5e0!3m2!1szh-TW!2stw!4v1764142830988!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>

            <div class="card">
                <h3>ğŸ„ æˆ¶å¤–æ´»å‹•</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=æ±äº¬è–èª•+Advent+in+ä¸Šé‡å…¬åœ’" target="_blank" class="location-link">
                    ğŸ“ æ±äº¬è–èª• Advent in ä¸Šé‡å…¬åœ’
                </a>
                <ul class="item-list">
                    <li><span class="time">æ—©ä¸Š</span> å·è¶ŠåŠæ—¥éŠ</li>
                    <li><span class="time">ä¸‹åˆ</span> è–èª•å¸‚é›† <span class="tag tag-xmas">è–èª•å¸‚é›†</span></li>
                    <li><span class="time">æ™šä¸Š</span> SKYTREE Dream Christmas 2025</li>
                </ul>
            </div>
            <div class="card">
                <h3>ğŸ½ï¸ æ™šé¤é ç´„</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=yakiniku+yattyattyan" target="_blank" class="location-link">
                    ğŸ“ yakiniku yattyattyan
                </a>
                <ul class="item-list">
                    <li><span class="time">21:30</span> é ç´„</li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>
        
        <div id="day-12-8" class="content" style="display:none;">
            <div class="day-title">ç¬¬ä¸‰å¤©ï¼šå¬°å…’å£«å°¼</div>
            
            <img src="/images/day03_disney_land.jpg" alt="è¿ªå£«å°¼æ¨‚åœ’" class="day-image">
            
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3242.790100527838!2d139.8778193752484!3d35.632900732628215!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60187d03114737b3%3A0xe4d93636d509d3cb!2z5p2x5Lqs6L-q5aOr5bC85qiC5ZyS!5e0!3m2!1szh-TW!2stw!4v1764142972772!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>

            <div class="card">
                <h3>ğŸ° è¿ªå£«å°¼æ¨‚åœ’</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=æ±äº¬è¿ªå£«å°¼æ¨‚åœ’" target="_blank" class="location-link">
                    ğŸ“ æ±äº¬è¿ªå£«å°¼æ¨‚åœ’
                </a>
                <ul class="item-list">
                    <li><span class="time">08:00</span> Check out Comfort Hotel</li>
                    <li><span class="time">09:00</span> ã‚¢ãƒªã‚¨ã‚¹ æ–°å®¿æ±å—å£åº— <span class="tag tag-reservation">é ç´„</span></li>
                    <li><span class="time">ä¸Šåˆ</span> å‰å¾€æ±äº¬è¿ªå£«å°¼æµ·æ´‹ Check-in å¤¢å¹»æ³‰é„‰ (12/8-12/9)</li>
                    <li><span class="time">17:00</span> ç¾å¥³èˆ‡é‡ç¸ <span class="tag tag-reservation">å·²é ç´„</span></li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>

        <div id="day-12-9" class="content" style="display:none;">
            <div class="day-title">ç¬¬å››å¤©ï¼šå¬°å…’å£«å°¼æµ·æ´‹</div>
            
            <img src="/images/day04_disney_sea.jpg" alt="è¿ªå£«å°¼æµ·æ´‹" class="day-image">
            
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3243.0410246706615!2d139.88250297524812!3d35.62671513296778!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60187d03114737b3%3A0x41471d704ab72d25!2z5p2x5Lqs6L-q5aOr5bC85rW35rSL!5e0!3m2!1szh-TW!2stw!4v1764143000637!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>

            <div class="card">
                <h3>ğŸ”± è¿ªå£«å°¼æµ·æ´‹ - å¤¢å¹»æ³‰é„‰</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=æ±äº¬è¿ªå£«å°¼æµ·æ´‹" target="_blank" class="location-link">
                    ğŸ“ æ±äº¬è¿ªå£«å°¼æµ·æ´‹
                </a>
                <ul class="item-list">
                    <li><span class="time">08:20</span> æ—©é¤é ç´„</li>
                    <li><span class="time">12:00</span> Check out å¤¢å¹»æ³‰é„‰</li>
                    <li>**é ç´„è¨­æ–½**ï¼š<span class="time">10:00</span> Elsaã€<span class="time">11:30</span> æ¨‚ä½©ã€<span class="time">13:30</span> å½¼å¾—æ½˜</li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>

        <div id="day-12-10" class="content" style="display:none;">
            <div class="day-title">ç¬¬äº”å¤©ï¼šå˜å“‡æ¨‚åœ’</div>
            
            <img src="/images/day05_chiikawa.jpg" alt="å‰ä¼Šå¡å“‡èˆ‡åŸå®¿" class="day-image">
            
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d25910.806406990017!2d139.6791950743164!3d35.729887699999985!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188d006f3d976b%3A0xc471e5c44aa64c5a!2sChiikawa%20Park!5e0!3m2!1szh-TW!2stw!4v1764143112168!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>

            <div class="card">
                <h3>ğŸ›ï¸ è³¼ç‰©èˆ‡ç¾é£Ÿ</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=å‰ä¼Šå¡å“‡æ¨‚åœ’" target="_blank" class="location-link">
                    ğŸ“ å‰ä¼Šå¡å“‡æ¨‚åœ’
                </a>
                <ul class="item-list">
                    <li><span class="time">æ—©ä¸Š</span> æ± è¢‹é€›è¡—</li>
                    <li><span class="time">ä¸­åˆ</span> ã­ãã— Negishi <span class="tag tag-food">åˆé¤</span></li>
                    <li><span class="time">13:40</span> æ¨‚åœ’ <span class="tag tag-reservation">é ç´„</span></li>
                </ul>
            </div>
            <div class="card">
                <h3>ğŸ„ è–èª•å¤œæ™¯</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=æ˜æ²»ç¥å®®å¤–è‹‘è–èª•å¸‚é›†" target="_blank" class="location-link">
                    ğŸ“ æ˜æ²»ç¥å®®å¤–è‹‘è–èª•å¸‚é›†
                </a>
                <ul class="item-list">
                    <li><span class="time">æ™šä¸Š</span> è–èª•å¸‚é›† <span class="tag tag-xmas">è–èª•å¸‚é›†</span></li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>
        
        <div id="day-12-11" class="content" style="display:none;">
            <div class="day-title">ç¬¬å…­å¤©ï¼šå…­æœ¬æœ¨è²¢ä¸¸ä¹‹å…§</div>
            
            <img src="/images/day06_roppongi.jpg" alt="å…­æœ¬æœ¨èˆ‡ä¸¸ä¹‹å…§" class="day-image">
            
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3241.627464952162!2d139.7382552752496!3d35.66154903105576!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188b2e40342225%3A0x3f9a1673138a69c1!2z6bq75biD5Y-w5LmL5LiY!5e0!3m2!1szh-TW!2stw!4v1764143323938!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>

            <div class="card">
                <h3>ğŸ—¼ å¸‚å€æ´»å‹•</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=å…­æœ¬æœ¨æ–°åŸ" target="_blank" class="location-link">
                    ğŸ“ å…­æœ¬æœ¨æ–°åŸ & éº»å¸ƒå°Hills
                </a>
                <ul class="item-list">
                    <li><span class="time">æ—©é¤</span> Tricolore coffee <span class="tag tag-food">å’–å•¡å»³</span></li>
                    <li><span class="time">ä¸Šåˆ</span> BINGO SPORTS æ±äº¬ã‚·ãƒ§ãƒ¼ãƒ«ãƒ¼ãƒ  <span class="tag tag-buy">å¯é¸/çœ‹è»Š</span></li>
                    <li><span class="time">ä¸­åˆ</span> è–èª•å¸‚é›†/é€›è¡— <span class="tag tag-xmas">è–èª•å¸‚é›†</span></li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>

        <div id="day-12-12" class="content" style="display:none;">
            <div class="day-title">ç¬¬ä¸ƒå¤©ï¼šè¿”ç¨‹æ—¥</div>
            
            <div class="flight-card">
                <div class="flight-header">
                    <div><span class="flight-time">14:20</span><p class="flight-airport" style="font-size: 0.6em;">NRT æ±äº¬</p></div>
                    <div><span class="flight-time">18:40</span><p class="flight-airport" style="font-size: 0.6em;">TPE å°åŒ— (å‡è¨­)</p></div>
                </div>
                <div class="flight-details">
                    <span class="flight-number">CI 0127</span>
                    <div class="flight-line"></div>
                    <span class="flight-duration">4h 20m</span>
                </div>
                <div class="flight-reminder">
                    ğŸ’¼ è«‹é ç•™å……è¶³æ™‚é–“è¾¦ç†ç™»æ©Ÿ
                </div>
            </div>
            
            <img src="/images/day07_departure.jpg" alt="è¿”ç¨‹" class="day-image">
            
            <div class="map-container">
                <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3240.85812501851!2d139.76043317525054!3d35.680495230015275!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x60188b39eb095801%3A0x64a29f9f2f81d5f7!2z5Li45LmL5YWn5Luy6YCa!5e0!3m2!1szh-TW!2stw!4v1764143400134!5m2!1szh-TW!2stw" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe>
            </div>

            <div class="card">
                <h3>âœˆï¸ è¿”ç¨‹èˆ‡è³¼ç‰©</h3>
                <a href="http://googleusercontent.com/maps.app.goo.gl/search?q=æˆç”°æ©Ÿå ´" target="_blank" class="location-link">
                    ğŸ“ æˆç”°æ©Ÿå ´
                </a>
                <ul class="item-list">
                    <li><span class="time">ä¸Šåˆ</span> Check-out é£¯åº—</li>
                    <li><span class="time">äº¤é€š</span> æ­ä¹˜ SKYLINER ç­æ¬¡: <span class="tag tag-reservation">14:20</span> æˆ– <span class="tag tag-reservation">14:37</span> è‡³æˆç”°</li>
                </ul>
            </div>
            
            <div class="weather-info">
                <a class="weatherwidget-io" href="https://forecast7.com/zh-tw/35d69139d69/tokyo/" data-label_1="TOKYO" data-label_2="WEATHER" data-font="å¾®è»Ÿæ­£é»‘é«” (Microsoft JhengHei)" data-theme="original" >TOKYO WEATHER</a>
            </div>
        </div>


        <div id="info" class="content" style="display:none;">
            <div class="day-title">ğŸ“ æ—…ç¨‹è³‡è¨Šç¸½è¦½</div>
            
            <div class="card">
                <h3>ğŸ—“ï¸ é‡è¦é ç´„ (ä¾æ—¥æœŸæ’åº)</h3>
                <ul class="item-list">
                    <li><span class="time">12/6 20:00</span> è‚‰å±‹æ©«ä¸ ç§‹è‘‰åŸ (æ™šé¤)</li>
                    <li><span class="time">12/7 21:30</span> yakiniku yattyattyan (æ™šé¤)</li>
                    <li><span class="time">12/8 09:00</span> ã‚¢ãƒªã‚¨ã‚¹ æ–°å®¿æ±å—å£åº— (å‰ªé«®)</li>
                    <li><span class="time">12/8 17:00</span> ç¾å¥³èˆ‡é‡ç¸ (è¿ªå£«å°¼)</li>
                    <li><span class="time">12/9 08:20</span> è¿ªå£«å°¼å¤¢å¹»æ³‰é„‰ (æ—©é¤)</li>
                    <li><span class="time">12/10 13:40</span> å‰ä¼Šå¡å“‡æ¨‚åœ’ (å…¥å ´)</li>
                </ul>
            </div>
            
            <div class="card">
                <h3>âœ… ä»»å‹™/æ‰“åŒ…æ¸…å–®</h3>
                <ul class="task-list">
                    <li><input type="checkbox" id="task-passport"><label for="task-passport">è­·ç…§ã€ç°½è­‰</label></li>
                    <li><input type="checkbox" id="task-esim"><label for="task-esim">ESIM / ç¶²è·¯å¡</label></li>
                    <li><input type="checkbox" id="task-charger"><label for="task-charger">æ‰‹æ©Ÿ/ç›¸æ©Ÿå……é›»å™¨</label></li>
                    <li><input type="checkbox" id="task-yen"><label for="task-yen">æ—¥å¹£ç¾é‡‘ (é ç•™ Â¥50000)</label></li>
                    <li><input type="checkbox" id="task-credit"><label for="task-credit">ä¿¡ç”¨å¡ (è‡³å°‘å…©å¼µ)</label></li>
                    <li><input type="checkbox" id="task-skyliner"><label for="task-skyliner">SKYLINER è»Šç¥¨</label></li>
                </ul>
                <p style="font-size: 0.8em; margin-top: 10px; color: #888;">* æ¸…å–®é›¢ç·šå„²å­˜ï¼Œéš¨æ™‚å¯æ‰“å‹¾</p>
            </div>
            
            <div class="card">
                <h3>âœˆï¸ èˆªç­è³‡è¨Š</h3>
                <ul class="item-list">
                    <li><span class="time">å»ç¨‹</span> 12/6 (é€±äº”) CI 0102 (TPE 08:00 - NRT 12:20)</li>
                    <li><span class="time">å›ç¨‹</span> 12/12 (é€±å››) CI 0127 (NRT 14:20 - TPE 18:40)</li>
                </ul>
            </div>
            <div class="card">
                <h3>ğŸ¨ ä½å®¿è³‡è¨Š</h3>
                <ul class="item-list">
                    <li><span class="time">12/6 - 12/8</span> Comfort Hotel Tokyo Kanda</li>
                    <li><span class="time">12/8 - 12/9</span> æ±äº¬è¿ªå£«å°¼æµ·æ´‹å¤¢å¹»æ³‰é„‰é£¯åº—</li>
                    <li><span class="time">12/9 - 12/12</span> REMM PLUS GINZA</li>
                </ul>
            </div>
        </div>

        <div id="budget" class="content" style="display:none;">
            <div class="day-title">ğŸ’° è¨˜å¸³ä¸­å¿ƒ (é€£å‹•ç‰ˆ)</div>
            
            <div class="card" style="background-color: #FFF0E6; border: 1px solid #D4A373;">
                <h3>ğŸ“Š é ç®—æ¦‚è¦½</h3>
                
                <div class="budget-input-group">
                    <label for="totalBudgetTWD">ç¸½é ç®— (TWD):</label>
                    <input type="number" id="totalBudgetTWD" value="0" placeholder="è¨­å®šæœ¬æ¬¡æ—…ç¨‹ç¸½é ç®— (å°å¹£)">
                    <button onclick="saveSettings()" class="action-button" style="background-color:#D4A373; color:white; margin-top: 5px;">å„²å­˜é ç®—</button>
                </div>

                <p style="margin-top: 15px; border-top: 1px solid #eee; padding-top: 10px;">
                    **ç¸½é ç®— (TWD):** <strong id="budget-twd-display" style="color:#D4A373;">NT$ 0</strong><br>
                    **å·²æ”¯å‡º (TWD):** <strong id="total-spent-twd" style="color:#D83A56;">è¼‰å…¥ä¸­...</strong><br>
                    **å‰©é¤˜é ç®— (TWD):** <strong id="remaining-twd" style="color:#79A37B;">è¼‰å…¥ä¸­...</strong>
                </p>
                
                <hr style="border: none; border-top: 1px dashed #E8E8E8; margin: 15px 0;">
                
                <p style="display: flex; justify-content: space-between; align-items: center;">
                    <span>**æ—¥å¹£ç¸½æ”¯å‡º:** <strong id="total-spent-jpy">è¼‰å…¥ä¸­...</strong></span>
                    <span style="display: flex; align-items: center;">
                        <label for="exchangeRate" style="margin-right: 5px;">ç•¶å‰åŒ¯ç‡:</label>
                        <input type="number" id="exchangeRate" value="0.215" step="0.001" style="width: 80px; display: inline-block; margin-right: 5px;">
                        <button onclick="saveSettings()" class="action-button" style="background-color:#D4A373; color:white; padding: 5px 10px; margin: 0;">æ›´æ–°åŒ¯ç‡</button>
                    </span>
                </p>
            </div>
            
            <div class="card">
                <h3>â• æ–°å¢æ”¯å‡º (åŒæ­¥è‡³è©¦ç®—è¡¨)</h3>
                <div class="budget-input-group">
                    <label for="expenseUser">ä½¿ç”¨è€…/æ—…ä¼´åç¨±:</label>
                    <input type="text" id="expenseUser" placeholder="ä¾‹å¦‚ï¼šå°æ˜" list="user-options">
                    <datalist id="user-options">
                        <option value="å°æ˜"></option>
                        <option value="å°è¯"></option>
                    </datalist>
                </div>
                <div class="budget-input-group">
                    <input type="text" id="expenseDesc" placeholder="é …ç›® (ä¾‹å¦‚ï¼šåˆé¤)">
                </div>
                <div class="budget-input-group">
                    <input type="number" id="expenseAmount" placeholder="é‡‘é¡ (JPY)">
                </div>
                <button onclick="addExpense()" class="action-button green" style="margin-top: 5px;">è¨˜éŒ„æ”¯å‡º</button>
            </div>

            <div class="card">
                <h3>ğŸ§¾ æ”¯å‡ºæ˜ç´° (åŒæ­¥æ–¼è©¦ç®—è¡¨)</h3>
                <ul id="expenseList" class="item-list">
                    <li>è¼‰å…¥è©¦ç®—è¡¨è³‡æ–™ä¸­...</li>
                </ul>
            </div>
        </div>

    </div>

    <script>
        // === é€£å‹•è¨˜å¸³çš„é—œéµåƒæ•¸ (å¾æ‚¨çš„è¨­å®šä¸­æå–) ===
        // å¯«å…¥è³‡æ–™ï¼šGoogle Forms åƒæ•¸
        const FORM_ACTION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSeVtVPc7iiETLE6mJAge1xwMl6EsfAbVgLp9E1utl8bfUrung/formResponse';
        const ENTRY_NAME = 'entry.816251805'; // ä½¿ç”¨è€…
        const ENTRY_DESCRIPTION = 'entry.691387664'; // æè¿°
        const ENTRY_JPY = 'entry.1564029987'; // æ—¥å¹£é‡‘é¡
        const ENTRY_TWD = 'entry.1946577129'; // å°å¹£é‡‘é¡

        // è®€å–è³‡æ–™ï¼šGoogle Sheets API åƒæ•¸
        const SPREADSHEET_ID = '1quyZDgEyX5FMDQmGAkVrQo7CJEFaEN16VHHTzgCrn5s';
        const API_KEY = 'AIzaSyCl_ODTCAkNG-hJ9uAvc9bGPhD59_LLJC8'; 
        // é—œéµä¿®æ­£ï¼šå°‡å·¥ä½œè¡¨åç¨±å¾ 'å·¥ä½œè¡¨1' æ”¹ç‚º 'Sheet1'
        const SHEET_API_URL = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/Sheet1!A2:E?key=${API_KEY}`;


        // === Hero å€å¡Šåˆ‡æ›é‚è¼¯ (çµåˆåœ–ç‰‡å’Œæ—¥æœŸåˆ‡æ›) ===
        const DATE_MAP = {
            1: { day: 6, weekday: 'FRI', time: '08:00', src: '/images/day01_arrival.jpg', fullDate: '2025.12.06 FRI', departureTime: '2025-12-06T08:00:00' },
            2: { day: 7, weekday: 'SAT', time: '09:00', src: '/images/day02_kawagoe.jpg', fullDate: '2025.12.07 SAT', departureTime: '2025-12-07T09:00:00' },
            3: { day: 8, weekday: 'SUN', time: '08:00', src: '/images/day03_disney_land.jpg', fullDate: '2025.12.08 SUN', departureTime: '2025-12-08T08:00:00' },
            4: { day: 9, weekday: 'MON', time: '08:20', src: '/images/day04_disney_sea.jpg', fullDate: '2025.12.09 MON', departureTime: '2025-12-09T08:20:00' },
            5: { day: 10, weekday: 'TUE', time: '09:00', src: '/images/day05_chiikawa.jpg', fullDate: '2025.12.10 TUE', departureTime: '2025-12-10T09:00:00' },
            6: { day: 11, weekday: 'WED', time: '08:00', src: '/images/day06_roppongi.jpg', fullDate: '2025.12.11 WED', departureTime: '2025-12-11T08:00:00' },
            7: { day: 12, weekday: 'THU', time: '14:20', src: '/images/day07_departure.jpg', fullDate: '2025.12.12 THU', departureTime: '2025-12-12T14:20:00' }
        };

        function showDay(tabId, dayIndex, clickedButton) {
            // éš±è—æ‰€æœ‰å…§å®¹å€å¡Š
            const contentIds = [
                'day-12-6', 'day-12-7', 'day-12-8', 'day-12-9', 'day-12-10', 
                'day-12-11', 'day-12-12', 'info', 'budget'
            ];
            contentIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            // é¡¯ç¤ºé¸æ“‡çš„å€å¡Š
            const targetElement = document.getElementById(tabId);
            if (targetElement) {
                targetElement.style.display = 'block';
            }

            // æ›´æ–°æ—¥æ›†æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.day-tab-box').forEach(btn => {
                btn.classList.remove('active');
            });
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // æ›´æ–° Hero Image å’Œæ™‚é–“çš„åˆ‡æ›
            const data = DATE_MAP[dayIndex];
            if (data) {
                document.getElementById('hero-img-bg').src = data.src;
                document.getElementById('hero-time-display').textContent = data.time;
                document.getElementById('hero-date-text-display').textContent = data.fullDate;
                document.getElementById('countdown-timer').dataset.targetTime = data.departureTime;
            }

            // ç¢ºä¿å·¥å…·æ¬„æŒ‰éˆ•å–æ¶ˆæ¿€æ´»
            document.querySelectorAll('.tab-button').forEach(btn => {
                 btn.classList.remove('active');
            });
            
            // ç¢ºä¿ Hero Header é¡¯ç¤º
            document.querySelector('.hero-header').style.display = 'block';
            document.querySelector('.calendar-strip').style.display = 'flex';
        }
        
        // å°ˆé–€ç”¨æ–¼é ‚éƒ¨å·¥å…·æ¬„æŒ‰éˆ•åˆ‡æ›
        function showTab(tabId, clickedButton) {
            // éš±è—æ‰€æœ‰å…§å®¹å€å¡Š
            const contentIds = [
                'day-12-6', 'day-12-7', 'day-12-8', 'day-12-9', 'day-12-10', 
                'day-12-11', 'day-12-12', 'info', 'budget'
            ];
            contentIds.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.style.display = 'none';
                }
            });

            // é¡¯ç¤ºé¸æ“‡çš„å€å¡Š
            const targetElement = document.getElementById(tabId);
            if (targetElement) {
                targetElement.style.display = 'block';
            }

            // æ›´æ–°å·¥å…·æ¬„æŒ‰éˆ•çš„ active ç‹€æ…‹
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active');
            });
            if (clickedButton) {
                clickedButton.classList.add('active');
            }
            
            // å–æ¶ˆåº•éƒ¨æ—¥æœŸæ–¹å¡Šçš„æ¿€æ´»ç‹€æ…‹
            document.querySelectorAll('.day-tab-box').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // éš±è— Hero å€å¡Šå’Œ Calendar Strip
            document.querySelector('.hero-header').style.display = 'none';
            document.querySelector('.calendar-strip').style.display = 'none';
        }
        
        // === å€’æ•¸è¨ˆæ™‚å™¨é‚è¼¯ (æ–°å¢) ===
        function updateCountdown() {
            // ç²å–ç•¶å‰æ¿€æ´»æ—¥æœŸçš„ç›®æ¨™æ™‚é–“ (é è¨­ä½¿ç”¨ Day 1 çš„èˆªç­æ™‚é–“)
            let targetTimeStr = document.getElementById('countdown-timer').dataset.targetTime || '2025-12-06T08:00:00';
            
            // æª¢æŸ¥æ˜¯å¦ç‚º info/budget é é¢ï¼Œå¦‚æœæ˜¯å‰‡è·³éè¨ˆæ™‚
            if (document.getElementById('info').style.display === 'block' || 
                document.getElementById('budget').style.display === 'block') {
                return;
            }

            const targetTime = new Date(targetTimeStr).getTime();
            const now = new Date().getTime();
            const distance = targetTime - now;
            
            const timerElement = document.getElementById('countdown-timer');

            if (distance < 0) {
                timerElement.textContent = "è¡Œç¨‹é€²è¡Œä¸­æˆ–å·²çµæŸ";
                return;
            }

            const days = Math.floor(distance / (1000 * 60 * 60 * 24));
            const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
            
            timerElement.textContent = `è·é›¢æ´»å‹•ï¼š${days}å¤© ${hours}æ™‚ ${minutes}åˆ†`;
        }
        
        // æ¯ 60 ç§’æ›´æ–°ä¸€æ¬¡å€’æ•¸è¨ˆæ™‚å™¨ (æ¸›å°‘è€—é›»)
        setInterval(updateCountdown, 60000); 
        
        // === é›¢ç·šä»»å‹™æ¸…å–®é‚è¼¯ (ä¿æŒä¸è®Š) ===
        function loadTaskList() {
            const listItems = document.querySelectorAll('.task-list input[type="checkbox"]');
            listItems.forEach(checkbox => {
                const isChecked = localStorage.getItem(checkbox.id) === 'true';
                checkbox.checked = isChecked;
                
                checkbox.addEventListener('change', () => {
                    localStorage.setItem(checkbox.id, checkbox.checked);
                });
            });
        }
        
        // === å…±äº«é€£å‹•è¨˜å¸³åŠŸèƒ½ JavaScript (è®€å–ã€å¯«å…¥ã€æ›´æ–°) ===
        
        // è¼‰å…¥è¨­å®šï¼ˆåŒ¯ç‡ã€ä½¿ç”¨è€…åç¨±å’Œç¸½é ç®—ï¼‰
        function loadData() {
            const savedRate = localStorage.getItem('exchangeRate') || 0.215;
            document.getElementById('exchangeRate').value = savedRate;

            const savedUser = localStorage.getItem('expenseUser') || '';
            document.getElementById('expenseUser').value = savedUser;

            const savedBudget = localStorage.getItem('totalBudgetTWD') || 0; 
            document.getElementById('totalBudgetTWD').value = savedBudget;
            document.getElementById('budget-twd-display').textContent = `NT$ ${parseFloat(savedBudget).toLocaleString()}`;

            // è¼‰å…¥é é¢æ™‚ï¼Œç«‹å³è®€å–è©¦ç®—è¡¨è³‡æ–™
            fetchExpensesFromSheet();
        }

        // å„²å­˜è¨­å®šï¼ˆåŒ¯ç‡ã€ä½¿ç”¨è€…åç¨±å’Œç¸½é ç®—ï¼‰
        function saveSettings() {
            const rate = document.getElementById('exchangeRate').value;
            const user = document.getElementById('expenseUser').value.trim();
            const budget = document.getElementById('totalBudgetTWD').value; 

            localStorage.setItem('exchangeRate', rate);
            localStorage.setItem('expenseUser', user);
            localStorage.setItem('totalBudgetTWD', budget);
            document.getElementById('budget-twd-display').textContent = `NT$ ${parseFloat(budget).toLocaleString()}`;

            fetchExpensesFromSheet(); // æ›´æ–°åŒ¯ç‡æˆ–é ç®—å¾Œé‡æ–°è¨ˆç®—ç¸½é¡/å‰©é¤˜
            alert('è¨­å®šå·²å„²å­˜ï¼');
        }

        // --- A. è®€å–åŠŸèƒ½ï¼šå¾ Google Sheet å–å¾—è³‡æ–™ (å³æ™‚ç¸½é¡èˆ‡æ˜ç´°) ---
        function fetchExpensesFromSheet() {
            // é¡¯ç¤ºè¼‰å…¥ä¸­è¨Šæ¯
            document.getElementById('total-spent-jpy').textContent = 'è¼‰å…¥ä¸­...';
            document.getElementById('total-spent-twd').textContent = 'è¼‰å…¥ä¸­...';
            document.getElementById('remaining-twd').textContent = 'è¼‰å…¥ä¸­...';
            document.getElementById('expenseList').innerHTML = '<li>è¼‰å…¥è©¦ç®—è¡¨è³‡æ–™ä¸­...</li>';

            fetch(SHEET_API_URL)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.values && data.values.length > 0) {
                        const expenses = data.values.map(row => ({
                            timestamp: row[0] || 'N/A', 
                            user: row[1] || 'åŒ¿å',
                            desc: row[2] || 'N/A',
                            amountJPY: parseFloat(row[3]) || 0, 
                            amountTWD: parseFloat(row[4]) || 0,
                        }));
                        renderExpenses(expenses);
                        updateSummary(expenses);
                    } else {
                        renderExpenses([]);
                        updateSummary([]);
                    }
                })
                .catch(error => {
                    console.error("Error fetching data from Google Sheets API:", error);
                    document.getElementById('total-spent-jpy').textContent = 'è®€å–å¤±æ•—';
                    document.getElementById('total-spent-twd').textContent = 'è®€å–å¤±æ•—';
                    document.getElementById('remaining-twd').textContent = 'è®€å–å¤±æ•—';
                    document.getElementById('expenseList').innerHTML = '<li><span style="color: red;">âš ï¸ è³‡æ–™è®€å–å¤±æ•—ï¼Œè«‹ç¢ºèª API å¯†é‘°èˆ‡è©¦ç®—è¡¨åç¨± (Sheet1)ã€‚</span></li>';
                });
        }
        
        // --- B. æ¸²æŸ“æ˜ç´°åˆ—è¡¨ ---
        function renderExpenses(expenses) {
            const list = document.getElementById('expenseList');
            list.innerHTML = ''; 

            if (expenses.length === 0) {
                list.innerHTML = '<li><span style="color: #AAAAAA;">ç›®å‰æ²’æœ‰æ”¯å‡ºç´€éŒ„ã€‚</span></li>';
                return;
            }

            expenses.slice().reverse().forEach(exp => {
                const listItem = document.createElement('li');
                const datePart = exp.timestamp.split(' ')[0].replace(/\//g, '-'); 
                listItem.innerHTML = `
                    <span class="time">${datePart}</span> 
                    [${exp.user}] ${exp.desc}ï¼š
                    Â¥${exp.amountJPY.toLocaleString()} 
                    (NT$ ${Math.round(exp.amountTWD).toLocaleString()})
                `;
                list.appendChild(listItem);
            });
        }

        // --- C. è¨ˆç®—ç¸½çµç®— ---
        function updateSummary(expenses) {
            let totalSpentJPY = 0;
            let totalSpentTWD = 0;
            const totalBudget = parseFloat(localStorage.getItem('totalBudgetTWD') || 0);

            expenses.forEach(exp => {
                totalSpentJPY += exp.amountJPY;
                totalSpentTWD += exp.amountTWD;
            });

            const remainingTWD = totalBudget - totalSpentTWD;
            
            // é¡¯ç¤ºçµæœ
            document.getElementById('total-spent-jpy').textContent = `Â¥${totalSpentJPY.toLocaleString()}`;
            document.getElementById('total-spent-twd').textContent = `NT$ ${Math.round(totalSpentTWD).toLocaleString()}`;
            document.getElementById('remaining-twd').textContent = `NT$ ${Math.round(remainingTWD).toLocaleString()}`;
            
            // æ ¹æ“šå‰©é¤˜é ç®—è®Šæ›´é¡è‰² 
            const remainingEl = document.getElementById('remaining-twd');
            if (remainingTWD < 0) {
                remainingEl.style.color = '#D83A56'; // è¶…å‡ºé ç®—ç”¨ç´…è‰²
            } else {
                remainingEl.style.color = '#79A37B'; // ä»åœ¨é ç®—å…§ç”¨ç¶ è‰²
            }
        }

        // --- D. å¯«å…¥åŠŸèƒ½ï¼šæäº¤è³‡æ–™åˆ° Google è¡¨å–® (åŒæ­¥) ---
        function addExpense() {
            const user = document.getElementById('expenseUser').value.trim();
            const desc = document.getElementById('expenseDesc').value.trim();
            const amountJPY = parseFloat(document.getElementById('expenseAmount').value);
            const rate = parseFloat(localStorage.getItem('exchangeRate') || 0.215);

            if (!user) {
                alert('è«‹è¼¸å…¥æ‚¨çš„ä½¿ç”¨è€…åç¨±ï¼');
                return;
            }
            if (!desc || isNaN(amountJPY) || amountJPY <= 0) {
                alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®å’Œæ—¥å¹£é‡‘é¡ï¼');
                return;
            }

            // 1. è¨ˆç®—å°å¹£é‡‘é¡
            const amountTWD = (amountJPY * rate).toFixed(0);

            // 2. æ§‹å»ºæäº¤åƒæ•¸
            const params = new URLSearchParams();
            params.append(ENTRY_NAME, user);
            params.append(ENTRY_DESCRIPTION, desc);
            params.append(ENTRY_JPY, amountJPY);
            params.append(ENTRY_TWD, amountTWD); 

            const submissionURL = FORM_ACTION_URL + '?' + params.toString();

            // 3. æäº¤è³‡æ–™åˆ° Google è¡¨å–®
            fetch(submissionURL, {
                method: 'GET', 
                mode: 'no-cors', 
            })
            .then(() => {
                alert(`æ”¯å‡ºåŒæ­¥æˆåŠŸï¼\nä½¿ç”¨è€…: ${user}\né …ç›®: ${desc}\né‡‘é¡: Â¥${amountJPY.toLocaleString()} (NT$ ${amountTWD.toLocaleString()})`);
                
                document.getElementById('expenseDesc').value = '';
                document.getElementById('expenseAmount').value = '';
                
                // å¯«å…¥æˆåŠŸå¾Œï¼Œé‡æ–°è®€å–ä¸¦æ›´æ–°é é¢
                setTimeout(fetchExpensesFromSheet, 1000); // å»¶é²ä¸€ç§’ç¢ºä¿å¯«å…¥å®Œæˆ
            })
            .catch((error) => {
                 // Fallback on write error
                 alert(`æ”¯å‡ºå·²å˜—è©¦åŒæ­¥ï¼è«‹åœ¨è©¦ç®—è¡¨ä¸­ç¢ºèªã€‚\né‡‘é¡: Â¥${amountJPY.toLocaleString()}`);
                 document.getElementById('expenseDesc').value = '';
                 document.getElementById('expenseAmount').value = '';
                 setTimeout(fetchExpensesFromSheet, 1000); 
            });

        }

        // é é¢è¼‰å…¥å¾Œï¼ŒåŸ·è¡Œè¼‰å…¥æ‰€æœ‰æ•¸æ“š
        window.addEventListener('load', () => {
             loadData(); 
             loadTaskList();
             updateCountdown();
        }); 
        
        // ç¢ºä¿åˆå§‹ç‹€æ…‹æ­£ç¢ºï¼Œéš±è—å…¶ä»–åˆ†é 
        document.addEventListener('DOMContentLoaded', () => {
             document.getElementById('day-12-7').style.display = 'none';
             document.getElementById('day-12-8').style.display = 'none';
             document.getElementById('day-12-9').style.display = 'none';
             document.getElementById('day-12-10').style.display = 'none';
             document.getElementById('day-12-11').style.display = 'none';
             document.getElementById('day-12-12').style.display = 'none';
             document.getElementById('info').style.display = 'none';
             document.getElementById('budget').style.display = 'none';
             
             const initialBottomTab = document.querySelector(`.day-tab-box[data-day-index="1"]`);
             if (initialBottomTab) {
                showDay('day-12-6', 1, initialBottomTab); 
             }
        });
    </script>
</body>
</html>
